using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading;
using System.Threading.Tasks;

namespace SUUSCLI
{
    class Program
    {
        private const String TRIGGER_EVENT_NAME = "Global\\SoftwareUpdateService_CYSCA_UpdateCheck";
        
        static void Main(string[] args)
        {
            //Try get a handle to the event
            Console.WriteLine("==== Software Update Service Command Line Management Tool ====");
            Console.WriteLine("       ==== by Serious Information Security Inc. ====");
            Console.WriteLine("Attempting to trigger a check for software updates by the service");

            Console.WriteLine("Opening global update trigger");
            EventWaitHandle ewh;
            try
            {
                ewh = EventWaitHandle.OpenExisting(TRIGGER_EVENT_NAME);
            } 
            catch (Exception e)
            {
                Console.WriteLine("ERROR: Unable to open update trigger event. Try restarting this VM, if it continues contact EXCON");
                Console.WriteLine(e.ToString());
                return;
            }

            Console.WriteLine("Triggering an update check");
            try
            {
                ewh.Set();
                ewh.Close();
                Console.WriteLine("Update Triggered.");
            }
            catch (ObjectDisposedException e)
            {
                Console.WriteLine("ERROR: An error occurred when trying to trigger the update. Try restarting this VM, if it continues contact EXCON");
                Console.WriteLine(e.ToString());
            }
            
        }
    }
}
