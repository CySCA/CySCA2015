/*global jQuery*/
/**
 * apsc-2015-internet
 * Global JS
 *
 * version: 0.0.1
 * file:    global.js
 * author:  Squiz Australia
 * change log:
 *     24-04-2015 10:04 - First revision
 */

/*
 * Table of Contents
 *
 * - Global
 * - Modules
 *    footer
 *    header
 *    homepage-breaking-news
 *    homepage-carousel
 *    homepage-current-priorities
 *    homepage-highlight-message
 *    homepage-secondary-message
 *    homepage-twitter-feed
 *    homepage-user-types
 *    landing-links
 *    search-filter
 *    accordion (0.0.7)
 *    pagination (0.0.1)
 *    slick (0.0.1)
 *    typeahead (0.1.1)
 */

/*
--------------------
Global
--------------------
*/
//  Declare JS Enabled.
$('body').removeClass('no-js').addClass('js-enabled');


/*
--------------------
Modules
--------------------
*/

//IE8 column clears	
$('.lt-ie9 .landing-links__list li:nth-child(3n+1)').addClass('nth-child-3np1');
$('.lt-ie9 .current-priorities__list li:nth-child(3n+1)').addClass('nth-child-3np1');
$('.lt-ie9 .breaking-news__list li:nth-child(3n+1)').addClass('nth-child-3np1');


//var minMq = '(min-width: 60em)';

/*
if (!window.matchMedia) {
    if (Modernizr.mq(minMq)) {
        greyscale()
    }
} else {
    window.matchMedia(minMq).addListener(function (mql) {
        // Empty console statement needed to ensure FF always runs this
        console.log();
        if (mql.matches) {
            greyscale()
        }
    });
    if (window.matchMedia(minMq).matches) {
        greyscale()
    }
}
*/

/*
function greyscale() {
    
	$('.landing-links__list-thumb').BlackAndWhite({
	    hoverEffect : true,
	    webworkerPath : false,
	    invertHoverEffect: false,
	    intensity:1,
	    speed: {
	        fadeIn: 150,
	        fadeOut: 150
	    },
	    onImageReady:function(img) {
	    }
	});

	$('.current-priorities__list-item a .thumb').BlackAndWhite({
	    hoverEffect : true,
	    webworkerPath : false,
	    invertHoverEffect: false,
	    intensity:1,
	    speed: {
	        fadeIn: 150,
	        fadeOut: 150
	    },
	    onImageReady:function(img) {
	    }
	});


}
*/

/*-- module:footer --*/ (function ($) {
    'use strict';


}(jQuery));

/*-- module:header --*/ (function ($) {
    'use strict';

    // Match this with the breakpoint at which the screen transforms
    // from smaller size to medium size
    var minMq = '(min-width: 64em)',
        $nav = $('#main-navigation'),
        $toggle = $('.navbar__toggle', $nav),
        $target = $('#' + $toggle.attr('aria-controls')),
        $menu = $('#mobile-menu');

    // Menu toggles
    $toggle.on('click', function () {

        if (!$(this).hasClass("navbar__toggle-active")) {

            $("html, body").addClass("mobile-menu-active");

            $("#page-wrapper").animate({
                left: '20em'
            }, 800, 'linear', function () {});

            $("#mobile-menu").animate({
                left: 0
            }, 800, 'linear', function () {
                $(".navbar__toggle").addClass("navbar__toggle-active");
            });
        } else {
            $("#page-wrapper").animate({
                left: '0'
            }, 300, 'linear', function () {
                $("html, body").removeClass("mobile-menu-active");
            });
            $("#mobile-menu").animate({
                left: '-20em'
            }, 300, 'linear', function () {
                $(".navbar__toggle").removeClass("navbar__toggle-active");
            });
        }


    });

    // Initial state
    $target.attr('aria-expanded', $toggle.hasClass('navbar__toggle-active'));

    // Load the mega menu
    function loadMega() {
        $('#navbar__dropdown').accessibleMegaMenu({
            openClass: 'active'
        });
    }

    // Preppend mobile navigation to body
    function printMobileMenu() {
        if ($menu.length === 0) {
            $('body').prepend('<div id="mobile-menu" class="mobile-menu">' + $('#navbar__dropdown').html() + '</div>');
        }
    }


    // Load the mega menu when the media query matches
    if (!window.matchMedia) {
        if (Modernizr.mq(minMq)) {
            loadMega();
        } else {
            printMobileMenu();
        }
        return;
    } else {
        window.matchMedia(minMq).addListener(function (mql) {
            // Empty console statement needed to ensure FF always runs this
            console.log();
            if (mql.matches) {
                loadMega();
                $('#mobile-menu').remove();
            } else {
                printMobileMenu();
            }
        });
    }

    if (window.matchMedia(minMq).matches) {
        loadMega();
    } else {
        printMobileMenu();
    }



}(jQuery));

/*-- module:homepage-breaking-news --*/ (function ($) {
    'use strict';


}(jQuery));

/*-- module:homepage-carousel --*/ (function ($) {
    'use strict';


    if ($('.carousel').length > 0) {

        $('.carousel__list').slick({
            appendArrows: $('.carousel__position'),
            adaptiveHeight: true,
            autoplay: true,
            autoplaySpeed: 5000,
            arrows: true,
            prevArrow: '<li class="prev"><a href="#"><span>Previous item </span><i class="icon-chevron-thin-left"></i></a></li>',
            nextArrow: '<li class="next"><a href="#"><span>Next item </span><i class="icon-chevron-thin-right"></i></a></li>',
            dots: true,
            draggable: false,
            mobileFirst: true,
            pauseOnHover: true,
            pauseOnDotsHover: true,
            speed: 500,
            swipe: true,
            touchMove: true
        });
    }

}(jQuery));

/*-- module:homepage-current-priorities --*/ (function ($) {
    'use strict';


    function filterPriorities(type) {
        var pItems = $('.current-priorities__list-item');
        var pItemsCurrent = pItems;
        var pPagination = $('.current-priorities__pagination');
        var paginationLinks = '<li class="active"><a href="#"><span>Listing 1</span></a></li>';
        var noItems;

        if (type == 'group0') {
            pItemsCurrent = pItems;
        } else {
            pItemsCurrent = pItems.filter('.' + type);
        }

        pItems.addClass('hidden');
        pItemsCurrent.removeClass('hidden');
        pItems.removeClass('visuallyhidden');

        noItems = pItemsCurrent.length;

        for (var counter = 1; counter < noItems; counter++) {
            if (counter % 6 == 0) {
                var paginationIndex = (counter / 6) + 1;
                paginationLinks = paginationLinks + '<li><a href="#"><span>Listing ' + paginationIndex + '</span></a></li>';
            }
        }

        if (noItems <= 6) {

            pPagination.html('');

        } else {

            pPagination.html(paginationLinks);

            $('li', pPagination).click(function () {

                $('li', pPagination).removeClass('active');
                $(this).addClass('active');
                paginatePriorities($(this).index() * 6);
                return false;
            });

            paginatePriorities(0);

        }

    }

    function paginatePriorities(index) {

        var pItems = $('.current-priorities__list-item').not('.hidden');
        var pPagination = $('.current-priorities__pagination');
        var noItems = pItems.length;

        if (noItems > 6) {
            for (var counter = 0; counter < noItems; counter++) {
                if ((counter >= index) && (counter < index + 6)) {
                    pItems.eq(counter).removeClass('visuallyhidden');
                } else {
                    pItems.eq(counter).addClass('visuallyhidden');
                }
            }
        }

    }

    if ($('.current-priorities__filter').css('display') != 'table') {
        //Mobile view

        if ($('.current-priorities__filter').length > 0) {
           // $('#main').css('display','block'); // carousel breaks if parent display table
            $('.current-priorities__list').slick({
               appendArrows: $('.current-priorities__position'),
                  adaptiveHeight: true,
                  autoplay: true,
                  autoplaySpeed: 5000,
                  arrows: true,
                  dots: true,
                  draggable: false,
                  mobileFirst: true,
                  pauseOnHover: true,
                  pauseOnDotsHover: true,
                  speed: 500,
                  swipe: true,
                  touchMove: true
            });
        }

        $('.current-priorities__filter li').click(function () {
            if ($('.current-priorities__filter').hasClass('open')) {
                $('.current-priorities__filter li').removeClass('active');
                $(this).addClass('active');

                var filter = $('a', $(this)).attr('class');
                console.log(filter);

                if (filter == 'group0') {
                    $('.current-priorities__list').slick('slickUnfilter');
                } else {
                    $('.current-priorities__list').slick('slickUnfilter').slick('slickFilter', '.' + filter);
                }

            }
            $('.current-priorities__filter').toggleClass('open');

            return false;
        });

        $('.current-priorities__filter').click(function () {
            $('.current-priorities__filter li.active').click();
        });

    } else {
        // Tablet & desktop view

        $('.current-priorities__filter a').click(function () {
            $('.current-priorities__filter li').removeClass('active');
            $(this).parent().addClass('active');

            var group = $(this).attr('class');
            filterPriorities(group);

            return false;
        });

        filterPriorities('group0');

    }


}(jQuery));



/*-- module:homepage-twitter-feed --*/ (function ($) {
    'use strict';

    $('.twitter-feed__pagination li').click(function () {
        $('.twitter-feed__pagination li').removeClass('active');
        $(this).addClass('active');
        var index = $(this).index();
        var feeds = $('.twitter-feed__list li');
        feeds.addClass('visuallyhidden');
        feeds.eq(index).removeClass('visuallyhidden');
        return false;
    }).filter(':first').click();


}(jQuery));


/*-- module:squiz-module-accordion --*/ (function ($) {
    'use strict';

    // Second example is a tab-like setup
    $('.tabs').UberAccordion({
        buttonClass: 'tabs__link',
        autoExpand: function () {
            return window.location.hash;
        },
        toggle: false,
        multiple: false,
        preventDefaultButton: true
    });
}(jQuery));

/*-- module:squiz-module-pagination --*/ (function ($) {
    'use strict';


}(jQuery));

/*-- module:squiz-module-slick --*/ (function ($) {
    'use strict';

    var $slideshow = $('.slick-slideshow');

    $slideshow.slick({
        dots: true,
        arrows: true,
        speed: 400,
        slide: '.slick-slideshow__slide',
        slidesToScroll: 3,
        slidesToShow: 3
    });
}(jQuery));

/*-- module:squiz-module-typeahead --*/ (function ($) {
    'use strict';

    // This example uses funnelback docs as an example of typeahead functionality
    var baseUrl = 'http://docs.funnelback.com',
        suggestPath = '/s/suggest.json',
        collection = 'funnelback_docs_1240',
        searchInput = $('#typeahead-query');

    searchInput.typeahead({
        name: 'site-search',
        limit: 10,
        remote: {
            url: baseUrl + suggestPath + '?collection=' + collection + '&partial_query=%QUERY',
            dataType: 'jsonp'
        }
    });
}(jQuery));

/*autocomplete for home-search*/
$(function () {
    if ($("#quick-search__query").length) {
        jQuery("input#quick-search__query").fbcompletion({
            'enabled': 'enabled',
                'collection': 'apsc-web',
                'program': 'http://apsc-search.clients.squiz.net/s/suggest.json',
                'alpha': '.5',
                'show': '10',
                'sort': '0',
                'length': '3',
                'delay': '0'
        });
    }
}(jQuery));
