{% extends 'intranet.html' %} 

{% block box %}

<div class="email">
  <div class="email-row">
    <div class="email-label">From:</div> 
    <div class="email-value">{{ mail.user_from().name }}</div>
  </div>
  <div class="email-row">
    <div class="email-label">To:</div> 
    <div class="email-value">{{ mail.user_to().name }}</div>
  </div>
  <div class="email-row">
    <div class="email-label">Subject:</div> 
    <div class="email-value">{{ mail.subject }}</div>
  </div>
  <div class="email-row">
    <div class="email-label">Timestamp:</div> 
    <div class="email-value">{{ mail.created() }}</div>
  </div>
  <div class="email-row">
    <div class="email-label">Message:</div> 
    <pre id="decrypted" class="email-body"></pre>
  </div>
</div>
  
{% endblock %}

{% block xscript %}
    <script>
        $.ajax({
            url : '/mail/{{ mail.id }}',
            success : function(result) {
                lines = result.split('\n');
                lines.splice(0, 8);
                lines.splice(-1, 1);
                ciphertext = lines.join('');
                msg = mail_decrypt('{{ user.mail_key }}', ciphertext);
                document.getElementById('decrypted').textContent=msg; 
            }
        });
    </script>
{% endblock %}
