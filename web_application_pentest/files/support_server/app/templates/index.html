{% extends 'base.html' %}

{% block content %}
<div>
  <div class="vspace flag-text">{{ flag }}</div>
  <div class="terminal">
    <pre id="log" class="terminal-screen"></pre>
    <form class="terminal-input" id="send_cmd" method="POST" action='#' autocomplete="off">
      &gt;
      <input type="text" id="cmd" name="cmd" class="terminal-command" value="">
      <input type="submit" style="display:none">
    </form>
    </div>
  </div>
</div>
{% endblock %}

{% block xscript %}
<script>
  $(document).ready(function(){

    var socket = io.connect('http://support.ecwi.cysca:9447/');

    $(window).on('beforeunload', function() {
      socket.disconnect();
    });

    socket.on('connect', function() {
      socket.emit('client_connect');
    });

    socket.on('client_recv', function(msg) {
      text = '';
      if (msg.data == '[connect]') {
        $('#log').val('');
        text = '&lt;server&gt; connected';
      } else {
        text = msg.data;
      }
      $('#log').append(text + '\n');
      $('#log').scrollTop($('#log').prop('scrollHeight'));
    });

    $('form#send_cmd').submit(function(event) {
      command = $('#cmd').val();
      $('#cmd').val('');
      socket.emit('run_command', { data: command });
      return false;
    });

  });
</script>
{% endblock %}
